{% extends "base.html" %}

{% block title %}íšŒì›íƒˆí‡´ - ìˆ­ì‹¤ëŒ€í•™êµ ê³µì§€ì‚¬í•­{% endblock %}

{% block styles %}
<style>
    .delete-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 40px 20px;
        margin-top: 30px;
        margin-bottom: 30px;
    }
    
    .delete-card {
        background: white;
        padding: 40px;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        text-align: center;
    }
    
    .delete-header {
        margin-bottom: 30px;
    }
    
    .delete-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        color: var(--error-color);
    }
    
    .delete-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
    }
    
    .delete-subtitle {
        color: var(--text-secondary);
        font-size: 1rem;
        line-height: 1.6;
    }
    
    .warning-section {
        background: rgba(var(--error-color), 0.1);
        border: 2px solid var(--error-color);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin: 30px 0;
        text-align: left;
    }
    
    .warning-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--error-color);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .warning-list {
        margin: 0;
        padding-left: 20px;
        color: var(--text-primary);
    }
    
    .warning-list li {
        margin-bottom: 8px;
        line-height: 1.5;
    }
    
    .info-section {
        background: var(--background-secondary);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin: 30px 0;
        text-align: left;
    }
    
    .info-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .info-content {
        color: var(--text-secondary);
        line-height: 1.6;
    }
    
    .confirmation-section {
        margin: 30px 0;
        padding: 24px;
        border: 1px solid var(--border-medium);
        border-radius: var(--radius-lg);
        background: var(--background-tertiary);
    }
    
    .confirmation-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
    }
    
    .confirmation-input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border-light);
        border-radius: var(--radius-md);
        font-size: 1rem;
        margin-bottom: 16px;
        text-align: center;
        font-weight: 600;
    }
    
    .confirmation-input:focus {
        outline: none;
        border-color: var(--error-color);
        box-shadow: 0 0 0 3px rgba(var(--error-color), 0.1);
    }
    
    .confirmation-input.valid {
        border-color: var(--success-color);
        background-color: rgba(var(--success-color), 0.1);
    }
    
    .confirmation-text {
        font-size: 0.9rem;
        color: var(--text-muted);
        text-align: center;
    }
    
    .action-buttons {
        display: flex;
        gap: 16px;
        justify-content: center;
        margin-top: 30px;
    }
    
    .cancel-button {
        padding: 12px 24px;
        background: var(--background-tertiary);
        color: var(--text-secondary);
        border: 2px solid var(--border-medium);
        border-radius: var(--radius-md);
        font-weight: 600;
        text-decoration: none;
        transition: var(--transition-normal);
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .cancel-button:hover {
        background: var(--background-secondary);
        color: var(--text-primary);
        border-color: var(--border-dark);
    }
    
    .delete-button {
        padding: 12px 24px;
        background: var(--error-color);
        color: white;
        border: 2px solid var(--error-color);
        border-radius: var(--radius-md);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-normal);
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .delete-button:hover:not(:disabled) {
        background: #DC2626;
        border-color: #DC2626;
        transform: translateY(-1px);
    }
    
    .delete-button:disabled {
        background: var(--text-muted);
        border-color: var(--text-muted);
        cursor: not-allowed;
        opacity: 0.6;
    }
    
    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 20px;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition-normal);
    }
    
    .back-button:hover {
        color: var(--primary-light);
    }
    
    .user-info {
        background: var(--background-secondary);
        border-radius: var(--radius-lg);
        padding: 20px;
        margin-bottom: 30px;
        text-align: left;
    }
    
    .user-info-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
    }
    
    .user-details {
        display: flex;
        flex-direction: column;
        gap: 8px;
        color: var(--text-secondary);
    }
    
    .user-detail {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .user-detail-label {
        font-weight: 500;
    }
    
    .user-detail-value {
        font-family: 'Courier New', monospace;
        background: rgba(var(--primary-color), 0.1);
        padding: 2px 8px;
        border-radius: var(--radius-sm);
    }
    
    @media (max-width: 768px) {
        .delete-container {
            padding: 30px 20px;
        }
        
        .delete-card {
            padding: 30px 20px;
        }
        
        .delete-title {
            font-size: 1.5rem;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .cancel-button,
        .delete-button {
            width: 100%;
            justify-content: center;
        }
        
        .user-detail {
            flex-direction: column;
            align-items: stretch;
            gap: 4px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <a href="/" class="back-button">
        â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
    </a>
    
    <div class="delete-container">
        <div class="delete-card">
            <div class="delete-header">
                <div class="delete-icon">âš ï¸</div>
                <h1 class="delete-title">íšŒì›íƒˆí‡´</h1>
                <p class="delete-subtitle">
                    ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                    ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </p>
            </div>
            
            <!-- ì‚¬ìš©ì ì •ë³´ í‘œì‹œ -->
            <div class="user-info">
                <div class="user-info-title">íƒˆí‡´í•  ê³„ì • ì •ë³´</div>
                <div class="user-details">
                    <div class="user-detail">
                        <span class="user-detail-label">ì´ë¦„:</span>
                        <span class="user-detail-value">{{ session.user.name }}</span>
                    </div>
                    <div class="user-detail">
                        <span class="user-detail-label">ì´ë©”ì¼:</span>
                        <span class="user-detail-value">{{ session.user.email }}</span>
                    </div>
                    <div class="user-detail">
                        <span class="user-detail-label">ê°€ì…ì¼:</span>
                        <span class="user-detail-value" id="join-date">í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>
            
            <!-- ê²½ê³  ì„¹ì…˜ -->
            <div class="warning-section">
                <div class="warning-title">
                    âš ï¸ ê³„ì • ì‚­ì œ ì‹œ ë‹¤ìŒ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤:
                </div>
                <ul class="warning-list">
                    <li><strong>êµ¬ë… ì„¤ì •:</strong> ëª¨ë“  ê³µì§€ì‚¬í•­ êµ¬ë… ì •ë³´</li>
                    <li><strong>ê°œì¸ ì •ë³´:</strong> ì´ë¦„, ì´ë©”ì¼ ë“± ê³„ì • ì •ë³´</li>
                    <li><strong>ì´ìš© ê¸°ë¡:</strong> ì„œë¹„ìŠ¤ ì´ìš© ê¸°ë¡ ë° ì„¤ì •</li>
                    <li><strong>ë³µêµ¬ ë¶ˆê°€:</strong> ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</li>
                </ul>
            </div>
            
            <!-- ì•ˆë‚´ ì„¹ì…˜ -->
            <div class="info-section">
                <div class="info-title">
                    ğŸ’¡ ê³„ì • ì‚­ì œ ì „ í™•ì¸ì‚¬í•­
                </div>
                <div class="info-content">
                    â€¢ êµ¬ë… í•´ì§€ë§Œ ì›í•˜ì‹ ë‹¤ë©´ 'êµ¬ë… ê´€ë¦¬' í˜ì´ì§€ì—ì„œ ê°œë³„ í•´ì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤<br>
                    â€¢ ì¼ì‹œì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì¤‘ë‹¨í•˜ë ¤ë©´ ë¡œê·¸ì•„ì›ƒ í›„ ì ‘ì†í•˜ì§€ ì•Šìœ¼ì‹œë©´ ë©ë‹ˆë‹¤<br>
                    â€¢ ê³„ì • ì‚­ì œ í›„ì—ë„ ì–¸ì œë“ ì§€ ë‹¤ì‹œ ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
                    â€¢ ì‚­ì œëœ ë°ì´í„°ëŠ” ê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤
                </div>
            </div>
            
            <!-- í™•ì¸ ì„¹ì…˜ -->
            <div class="confirmation-section">
                <div class="confirmation-title">
                    ê³„ì • ì‚­ì œë¥¼ í™•ì¸í•˜ë ¤ë©´ ì•„ë˜ ì…ë ¥ì°½ì— <strong>"ê³„ì •ì‚­ì œ"</strong>ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:
                </div>
                <input type="text" id="confirmation-input" class="confirmation-input" 
                       placeholder="ê³„ì •ì‚­ì œ" maxlength="4">
                <div class="confirmation-text">
                    ì •í™•íˆ ì…ë ¥í•˜ì…”ì•¼ ì‚­ì œ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.
                </div>
            </div>
            
            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="action-buttons">
                <a href="/" class="cancel-button">
                    ğŸ”™ ì·¨ì†Œí•˜ê³  ëŒì•„ê°€ê¸°
                </a>
                <button id="delete-button" class="delete-button" disabled>
                    ğŸ—‘ï¸ ê³„ì • ì™„ì „ ì‚­ì œ
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const confirmationInput = document.getElementById('confirmation-input');
    const deleteButton = document.getElementById('delete-button');
    const requiredText = 'ê³„ì •ì‚­ì œ';
    
    // ê°€ì…ì¼ í‘œì‹œ
    document.addEventListener('DOMContentLoaded', function() {
        // ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê°€ì…ì¼ì„ ì „ë‹¬ë°›ì•„ì•¼ í•¨
        // í˜„ì¬ëŠ” ì„ì‹œë¡œ í˜„ì¬ ë‚ ì§œ í‘œì‹œ
        const joinDateElement = document.getElementById('join-date');
        joinDateElement.textContent = 'ì •ë³´ ì—†ìŒ';
    });
    
    // í™•ì¸ í…ìŠ¤íŠ¸ ì…ë ¥ ê²€ì¦
    confirmationInput.addEventListener('input', function() {
        const inputValue = this.value.trim();
        
        if (inputValue === requiredText) {
            this.classList.add('valid');
            deleteButton.disabled = false;
            deleteButton.style.background = 'var(--error-color)';
            deleteButton.style.borderColor = 'var(--error-color)';
        } else {
            this.classList.remove('valid');
            deleteButton.disabled = true;
            deleteButton.style.background = 'var(--text-muted)';
            deleteButton.style.borderColor = 'var(--text-muted)';
        }
    });
    
    // ê³„ì • ì‚­ì œ ì²˜ë¦¬
    deleteButton.addEventListener('click', function() {
        if (this.disabled) return;
        
        // ìµœì¢… í™•ì¸
        const finalConfirm = confirm(
            'ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n' +
            'ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.\n\n' +
            'í™•ì¸ì„ ëˆ„ë¥´ì‹œë©´ ê³„ì •ì´ ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤.'
        );
        
        if (!finalConfirm) {
            return;
        }
        
        // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© ìƒíƒœ
        this.disabled = true;
        const originalText = this.innerHTML;
        this.innerHTML = 'â³ ê³„ì • ì‚­ì œ ì¤‘...';
        
        // ì„œë²„ì— ì‚­ì œ ìš”ì²­
        fetch('/delete-account', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showAlert('ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤.', 'success');
                
                // 2ì´ˆ í›„ í™ˆí˜ì´ì§€ë¡œ ì´ë™
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
            } else {
                throw new Error(data.message || 'ê³„ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        })
        .catch(error => {
            console.error('Account deletion error:', error);
            showAlert('ê³„ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.', 'error');
            
            // ë²„íŠ¼ ìƒíƒœ ë³µì›
            this.disabled = false;
            this.innerHTML = originalText;
        });
    });
    
    // í˜ì´ì§€ ì´íƒˆ ê²½ê³ 
    let isDeleting = false;
    window.addEventListener('beforeunload', function(e) {
        if (!isDeleting && confirmationInput.value.trim() === requiredText) {
            e.preventDefault();
            e.returnValue = 'í˜ì´ì§€ë¥¼ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ? ì…ë ¥í•œ ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.';
        }
    });
    
    // ESC í‚¤ë¡œ í˜ì´ì§€ ë‚˜ê°€ê¸°
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (confirm('ê³„ì • ì‚­ì œë¥¼ ì·¨ì†Œí•˜ê³  í™ˆìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.location.href = '/';
            }
        }
    });
</script>
{% endblock %}